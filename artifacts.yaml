# For building Gloo artifacts with Valet
# From the root of the repo:
# valet build -v $(git describe --tags --dirty | cut -c 2-)

build:
  go:
    version: github.com/solo-io/gloo/pkg/version.Version
    gcFlags: "all=-N -l"
    binaries:
      - name: glooctl
        os: [linux, darwin, windows]
        entrypoint: projects/gloo/cli/cmd/main.go
        #tests:
        #  - path: install/test
      - name: gloo
        entrypoint: projects/gloo/cmd/main.go
      - name: discovery
        entrypoint: projects/discovery/cmd/main.go
      - name: gateway
        entrypoint: projects/gateway/cmd/main.go
      - name: envoyinit
        entrypoint: projects/envoyinit/cmd/main.go
      - name: ingress
        entrypoint: projects/ingress/cmd/main.go
      - name: gateway-conversion
        entrypoint: projects/gateway/pkg/conversion/cmd/main.go

docker:
  registries: [quay.io/solo-io]
  containers:
    - name: gloo
      dockerfile: projects/gloo/cmd/Dockerfile
    - name: gateway
      dockerfile: projects/gateway/cmd/Dockerfile
    - name: discovery
      dockerfile: projects/discovery/cmd/Dockerfile
    - name: gloo-envoy-wrapper
      dockerfile: projects/envoyinit/cmd/Dockerfile
    - name: gateway-conversion
      dockerfile: projects/gateway/pkg/conversion/cmd/Dockerfile

helm:
  charts:
    - name: gloo
      directory: install/helm/gloo
      generator: install/helm/gloo/generate.go
      manifests:
        - name: gloo-gateway.yaml
        - name: gloo-ingress.yaml
          values: values-ingress.yaml
        - name: gloo-knative.yaml
          values: values-knative.yaml

productName: gloo